<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha Médica - Urutrek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            urutrek: {
              orange: '#ea580c',
              'orange-dark': '#c2410c'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans text-gray-800">
  <div class="container mx-auto px-4 py-6 lg:py-12">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
      <!-- Header -->
      <div class="bg-urutrek-orange text-white p-6 sm:p-8">
        <div class="flex flex-col sm:flex-row items-center justify-between">
          <div class="flex items-center space-x-4 mb-4 sm:mb-0">
            <img src="LOGO 2 - COLOR.png" alt="Urutrek Logo" class="h-12 sm:h-16 bg-white p-2 rounded">
            <div>
              <h1 class="text-2xl sm:text-3xl font-bold">Ficha Médica</h1>
              <p class="text-orange-100 text-sm">Completa toda la información requerida</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Form -->
      <div class="p-6 sm:p-8">
        <form id="ficha-form" class="space-y-6">
          
          <!-- Datos Personales -->
          <div class="bg-gray-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Datos Personales</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Apellido y Nombre *</label>
                <input type="text" name="nombre" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="Ingresa tu nombre completo">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">DNI *</label>
                <input type="text" name="dni" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="12.345.678">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha de Nacimiento *</label>
                <input type="date" name="fecha_nacimiento" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Edad *</label>
                <input type="number" name="edad" min="1" max="120" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="25">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Género *</label>
                <select name="genero" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required>
                  <option value="">Seleccionar...</option>
                  <option value="M">Masculino</option>
                  <option value="F">Femenino</option>
                  <option value="X">No binario</option>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Teléfono *</label>
                <input type="tel" name="telefono" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="+54 9 11 1234-5678">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                <input type="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="nombre@email.com">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Ciudad *</label>
                <input type="text" name="ciudad" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="Buenos Aires">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Provincia *</label>
                <input type="text" name="provincia" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="Buenos Aires">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">País *</label>
                <input type="text" name="pais" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-urutrek-orange focus:border-transparent transition-all" required placeholder="Argentina" value="Argentina">
              </div>
            </div>
          </div>

          <!-- Contacto de Emergencia -->
          <div class="bg-red-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Contacto de Emergencia</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Nombre Completo *</label>
                <input type="text" name="emergencia_nombre" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" required placeholder="Nombre del contacto">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Relación *</label>
                <select name="emergencia_relacion" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" required>
                  <option value="">Seleccionar...</option>
                  <option value="Padre/Madre">Padre/Madre</option>
                  <option value="Hermano/a">Hermano/a</option>
                  <option value="Esposo/a">Esposo/a</option>
                  <option value="Hijo/a">Hijo/a</option>
                  <option value="Amigo/a">Amigo/a</option>
                  <option value="Otro">Otro</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Teléfono *</label>
                <input type="tel" name="emergencia_telefono" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" required placeholder="+54 9 11 1234-5678">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                <input type="email" name="emergencia_email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" placeholder="emergencia@email.com">
              </div>
            </div>
          </div>

          <!-- Información Médica -->
          <div class="bg-blue-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Información Médica</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Obra Social/Prepaga</label>
                <input type="text" name="obra_social" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="OSDE, Swiss Medical, etc.">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Número de Afiliado</label>
                <input type="text" name="numero_afiliado" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="123456789">
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Grupo Sanguíneo</label>
                <select name="grupo_sanguineo" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                  <option value="">Seleccionar...</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Médico de Cabecera</label>
                <input type="text" name="medico_cabecera" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Dr. Juan Pérez">
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">¿Tiene alguna alergia? *</label>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="tiene_alergias" value="no" class="mr-2 text-blue-500" required>
                  <span>No tengo alergias</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="tiene_alergias" value="si" class="mr-2 text-blue-500" required>
                  <span>Sí tengo alergias</span>
                </label>
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Especificar alergias (si corresponde)</label>
              <textarea name="alergias_detalle" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Detalla tus alergias (medicamentos, alimentos, ambientales, etc.)"></textarea>
            </div>
            
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">¿Toma alguna medicación regularmente? *</label>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="toma_medicacion" value="no" class="mr-2 text-blue-500" required>
                  <span>No tomo medicación</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="toma_medicacion" value="si" class="mr-2 text-blue-500" required>
                  <span>Sí tomo medicación</span>
                </label>
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Medicación actual (si corresponde)</label>
              <textarea name="medicacion_detalle" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Lista los medicamentos que tomas regularmente"></textarea>
            </div>
          </div>

          <!-- Condiciones Médicas -->
          <div class="bg-yellow-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Condiciones Médicas</h2>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">¿Ha tenido alguna de estas condiciones? (Marcar todas las que correspondan)</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="diabetes" class="mr-2"> Diabetes</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="hipertension" class="mr-2"> Hipertensión</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="asma" class="mr-2"> Asma</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="epilepsia" class="mr-2"> Epilepsia</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="problemas_cardiacos" class="mr-2"> Problemas cardíacos</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="problemas_respiratorios" class="mr-2"> Problemas respiratorios</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="artritis" class="mr-2"> Artritis</label>
                  <label class="flex items-center"><input type="checkbox" name="condiciones" value="problemas_espalda" class="mr-2"> Problemas de espalda</label>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Otras condiciones médicas</label>
                <textarea name="otras_condiciones" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" placeholder="Menciona cualquier otra condición médica relevante"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">¿Ha tenido cirugías recientes? (últimos 2 años)</label>
                <textarea name="cirugias_recientes" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" placeholder="Describe cualquier cirugía reciente"></textarea>
              </div>
            </div>
          </div>

          <!-- Actividad Física -->
          <div class="bg-green-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Actividad Física</h2>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Nivel de actividad física *</label>
                <select name="nivel_actividad" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" required>
                  <option value="">Seleccionar...</option>
                  <option value="sedentario">Sedentario (poco o nada de ejercicio)</option>
                  <option value="ligero">Ligero (ejercicio 1-3 días/semana)</option>
                  <option value="moderado">Moderado (ejercicio 3-5 días/semana)</option>
                  <option value="intenso">Intenso (ejercicio 6-7 días/semana)</option>
                  <option value="muy_intenso">Muy intenso (ejercicio intenso diario)</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">¿Practica trekking habitualmente? *</label>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input type="radio" name="practica_trekking" value="nunca" class="mr-2 text-green-500" required>
                    <span>Nunca</span>
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="practica_trekking" value="ocasional" class="mr-2 text-green-500" required>
                    <span>Ocasionalmente</span>
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="practica_trekking" value="frecuente" class="mr-2 text-green-500" required>
                    <span>Frecuentemente</span>
                  </label>
                  <label class="flex items-center">
                    <input type="radio" name="practica_trekking" value="experto" class="mr-2 text-green-500" required>
                    <span>Soy un trekker experimentado</span>
                  </label>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Experiencia en montañismo/trekking</label>
                <textarea name="experiencia_trekking" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Describe tu experiencia previa en trekking, montañismo o actividades similares"></textarea>
              </div>
            </div>
          </div>

          <!-- Declaración y Consentimiento -->
          <div class="bg-gray-50 p-4 sm:p-6 rounded-lg">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Declaración y Consentimiento</h2>
            
            <div class="space-y-4">
              <div class="flex items-start">
                <input type="checkbox" name="declaro_veracidad" class="mt-1 mr-3" required>
                <label class="text-sm text-gray-700">
                  <strong>Declaro que toda la información proporcionada es verdadera y completa.</strong> Entiendo que cualquier información falsa u omitida puede afectar mi seguridad durante la actividad.
                </label>
              </div>
              
              <div class="flex items-start">
                <input type="checkbox" name="acepto_responsabilidad" class="mt-1 mr-3" required>
                <label class="text-sm text-gray-700">
                  <strong>Acepto la responsabilidad de informar inmediatamente cualquier cambio en mi condición médica</strong> que pueda afectar mi participación en las actividades de trekking.
                </label>
              </div>
              
              <div class="flex items-start">
                <input type="checkbox" name="autorizo_atencion" class="mt-1 mr-3" required>
                <label class="text-sm text-gray-700">
                  <strong>Autorizo a Urutrek y su personal</strong> a tomar las medidas necesarias para mi atención médica en caso de emergencia, incluyendo el contacto con servicios médicos de emergencia.
                </label>
              </div>
            </div>
          </div>

          <!-- Botones -->
          <div class="flex flex-col sm:flex-row gap-4 pt-6">
            <button type="submit" id="submit-btn" class="flex-1 bg-urutrek-orange text-white px-6 py-3 rounded-lg hover:bg-urutrek-orange-dark transition-colors font-semibold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-transform">
              Enviar Ficha Médica
            </button>
            <button type="reset" class="flex-1 sm:flex-none bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors font-semibold">
              Limpiar Formulario
            </button>
          </div>
          
          <div id="status" class="mt-4 text-sm text-center"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Calcular edad automáticamente
    document.querySelector('input[name="fecha_nacimiento"]').addEventListener('change', function() {
      const fechaNac = new Date(this.value);
      const hoy = new Date();
      let edad = hoy.getFullYear() - fechaNac.getFullYear();
      const mes = hoy.getMonth() - fechaNac.getMonth();
      
      if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
        edad--;
      }
      
      document.querySelector('input[name="edad"]').value = edad;
    });

    // JavaScript del formulario
    document.getElementById("ficha-form").addEventListener("submit", function(e) {
      e.preventDefault();
      
      const form = e.target;
      const submitBtn = document.getElementById("submit-btn");
      const status = document.getElementById("status");
      
      // Estado de carga
      submitBtn.disabled = true;
      submitBtn.textContent = "Enviando...";
      status.textContent = "Enviando datos...";
      status.className = "mt-4 text-blue-600 text-sm text-center";

      // Crear FormData y procesar checkboxes múltiples
      const formData = new FormData(form);
      
      // Manejar checkboxes múltiples (condiciones médicas)
      const condiciones = [];
      document.querySelectorAll('input[name="condiciones"]:checked').forEach(checkbox => {
        condiciones.push(checkbox.value);
      });
      
      // Remover entradas individuales de condiciones y agregar como array
      formData.delete('condiciones');
      formData.append('condiciones', condiciones.join(', '));
      
      // Mostrar datos que se van a enviar (para debug)
      console.log('Datos a enviar:');
      for (let [key, value] of formData.entries()) {
        console.log(key + ':', value);
      }

      // Enviar datos
      fetch("https://script.google.com/macros/s/AKfycbyM_Yx-sxOBWWk7Pzcph8sj3cbWHni2zuH8v4nPcsJ4CSQaiLPFsGaPvolbvc5A-GO7/exec", {
        method: "POST",
        body: formData
      })
      .then(response => {
        console.log('Status:', response.status);
        console.log('OK:', response.ok);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        return response.text();
      })
      .then(text => {
        console.log('Respuesta raw:', text);
        
        let result;
        try {
          result = JSON.parse(text);
          console.log('JSON parseado:', result);
        } catch (e) {
          console.error('Error parseando JSON:', e);
          throw new Error('Respuesta no válida del servidor');
        }
        
        if (result.status === "success" || result.status === "ok") {
          status.textContent = "✓ " + (result.message || "Ficha médica enviada correctamente");
          status.className = "mt-4 text-green-600 text-sm text-center font-semibold";
          form.reset();
          
          // Scroll al mensaje de éxito
          status.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
          throw new Error(result.message || "Error desconocido del servidor");
        }
      })
      .catch(error => {
        console.error('Error completo:', error);
        status.textContent = "✗ Error: " + error.message;
        status.className = "mt-4 text-red-600 text-sm text-center font-semibold";
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = "Enviar Ficha Médica";
      });
    });
  </script>
</body>
</html>